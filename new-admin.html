<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>管理员的主页</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content="Truck Responsive web template, Bootstrap Web Templates, Flat Web Templates, Andriod Compatible web template,Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyErricsson, Motorola web design" />
	<link href="bootstrap.min.css" rel="stylesheet">
	<link href="animate.css" rel="stylesheet" type="text/css" media="all">
	<link rel="stylesheet" type="text/css" href="theme.css">
	<link rel="stylesheet" type="text/css" href="sweetalert.css">
	<link rel="stylesheet" type="text/css" href="adminStyle.css">
	<script type="text/javascript" src="jquery-3.2.1.min.js"></script>
	<script src="bootstrap.min.js"></script>
	<script type="text/javascript" src="sweetalert-dev.js"></script>
</head>
<body>
	<div class="container head">
		<div class="header">
			<div class="head-logo">
				<a href="#index">HTTQM</a>
			</div>
			<div class="top-nav">
				<span class="menu"><img src="menu.png" alt=""></span>
				<ul class="nav1">
					<li class="hvr-sweep-to-bottom active"><a href="#index">主页</a></li>
					<li class="hvr-sweep-to-bottom"><a href="#userList">用户管理</a></li>
					<li class="hvr-sweep-to-bottom"><a href="#qrcode">二维码管理</a></li>
					<li class="logout"><a href="new-signin.html">退出</a></li>
					<div class="clearfix"> </div>
				</ul>
			</div>
			<div class="clearfix"> </div>
		</div>
	</div>
	<!-- 主页？ -->
	<!-- 用户管理 -->
	<div class="container">
		<div class="row">
			<div class="span12">
				<div class="content">					
					<div id="demo">
						<div id="indemo">
							<div id="demo1">
								<ul>
	           						<li><p style="text-align:center;">message</p></li>
         							<li><p style="text-align:center;">message</p></li>
          						</ul>
          					</div>
							<div id="demo2">
								<ul>
	           						<li><p style="text-align:center;">message</p></li>
         							<li><p style="text-align:center;">message</p></li>
          						</ul>
          					</div>
						</div>
					</div>
					<script>
						var speed=20;
						var tab=document.getElementById("demo");
						var tab1=document.getElementById("demo1");
						var tab2=document.getElementById("demo2");
						tab2.innerHTML=tab1.innerHTML;
						//向左滚动
						function Marquee(){
							if(tab2.offsetWidth-tab.scrollLeft<=0)
								tab.scrollLeft-=tab1.offsetWidth
							else{
								tab.scrollLeft++;
							}
						}
						//向右滚动
						function Marquee2(){
 							if(tab.scrollLeft<=0)
 								tab.scrollLeft+=demo2.offsetWidth
 							else{
 								tab.scrollLeft--
 							}
 						}
						var MyMar=setInterval(Marquee,speed);
//						tab.onmouseover=function() {clearInterval(MyMar)};
//						tab.onmouseout=function() {MyMar=setInterval(Marquee,speed)};
					</script>
					<div class="btn-controls">
						<div class="btn-box-row row-fluid">
							<a href="javascript:;" class="btn-box big span3 totalUser"><i></i><p class="text-muted">总用户数</p></a>
							<a href="javascript:;" class="btn-box big span3 totalCode"><i></i><p class="text-muted">总二维码数</p></a>
							<a href="javascript:;" class="btn-box big span3 totalScan"><i></i><p class="text-muted">总扫描次数</p></a>
							<a href="javascript:;" class="btn-box big span3 scanUser"><i></i><p class="text-muted">总扫描用户数</p></a>
						</div>
						<div class="btn-box-row row-fluid">
							<div class="span8">
								<div class="row-fluid">
									<div class="span12">
										<a href="#" class="btn-box small span6 newUser"><i></i><b>今日新增用户</b></a>
										<a href="#" class="btn-box small span6 newScan"><i></i><b>今日新增扫描</b></a>
									</div>
								</div>
							</div>
							<ul class="widget widget-usage unstyled span4">
								<li>
									<p>
										<strong>用户新增率</strong> <span class="pull-right small muted userRate"></span>
									</p>
									<div class="progress tight userRateBar">
										<div class="bar" style="width: 0%;">
										</div>
									</div>
								</li>
								<li>
									<p>
										<strong>扫描新增率</strong> <span class="pull-right small muted scanRate"></span>
									</p>
									<div class="progress tight scanRateBar">
										<div class="bar bar-success" style="width: 0%;">
										</div>
									</div>
								</li>
							</ul>
						</div>
					</div>
					<!--/#btn-controls-->
					<div class="module">
						<div class="module-head">
							<h3>Profit Chart</h3>
						</div>
						<div class="module-body">
							<div class="chart inline-legend grid">
								<div id="placeholder2" class="graph" style="height: 500px">
								</div>
							</div>
						</div>
					</div>
					<!--/.module-->
					<div class="module hide">
						<div class="module-head">
							<h3>
							Adjust Budget Range</h3>
						</div>
						<div class="module-body">
							<div class="form-inline clearfix">
								<a href="#" class="btn pull-right">Update</a>
								<label for="amount">
								Price range:</label>
								&nbsp;
								<input type="text" id="amount" class="input-" />
							</div>
							<hr />
							<div class="slider-range">
							</div>
						</div>
					</div>
					<div class="module">
						<div class="module-head">
							<h3>用户列表</h3>
						</div>
						<div class="module-body table">
							<table cellpadding="0" cellspacing="0" border="0" class="datatable-1 table table-bordered table-striped	display"
							width="100%">
							<thead>
								<tr>
									<th>用户</th>
									<th>微信公众号</th>
									<th>注册时间</th>
									<!-- <th>生成二维码个数</th> -->
									<th>操作</th>
								</tr>
							</thead>
							<tbody class="userList">
								<tr>
									<td>11111111111111</td>
									<td>11111111111111</td>
									<td>11111111111111</td>
									<td><input type="button" class="btn btn-danger stopAcnt" value="停用"><input type="button" class="btn btn-success coverAcnt" value="恢复"><input type="button" class="btn btn-warning resetAcnt" value="重置"></td>
								</tr>
							</tbody>
							<!-- <tfoot>
								<tr>
									<th colspan="3" style="text-align: right;">
										<a href="javascript:;" id="lastPage">上一页</a>
										<a href="javascript:;" id="nowPage">第<b></b>页</a>
										<a href="javascript:;" id="nextPage">下一页</a>
									</th>
								</tr>
							</tfoot> -->
						</table>
					</div>
				</div>
				<!--/.module-->
			</div>
			<!--/.content-->
		</div>
		<!--/.span9-->
	</div>
</div>
</body>
<script type="text/javascript">
	var opAccount;
	$(".nav1 .hvr-sweep-to-bottom").click(function() {
		$(".nav1 .hvr-sweep-to-bottom").removeClass("active");
		$(this).addClass('active');
	});
	var adminOperation = function() {

	};
	//验证access id
	adminOperation.prototype.userCheck = function() {
		$.ajax({
			type: "post",
			url: "userCheck.php",
			dataType: "json",
			data: {},
			success: function(){

			}
		});
	};

	//账户操作
	adminOperation.prototype.operateAccount = function(tp){
		$.ajax({
			type: 'post',
			url: 'adminMidFunc.php',
			dataType: 'json',
			data: {
				type: 1,
				tp: tp,
				acnt: opAccount
			},
			success: function(data){
				if(tp == 1){
					swal("", "该账户停用成功", "success");
				} else if(tp == 0){
					swal("", "该账户恢复成功", "success");
				} else if(tp == 2){
					swal("", "该账户密码重置成功", "success");
				}
			}
		})
	}

	//弹窗
	adminOperation.prototype.myAlert = function(tit, txt, func, arg){
		swal({ 
  			title: tit, 
  			text: txt, 
  			type: "warning",
  			showCancelButton: true, 
  			confirmButtonColor: "#DD6B55",
  			confirmButtonText: "确定", 
  			cancelButtonText: "取消",
  			closeOnConfirm: false
		},
		function(){
			func(arg);
		});
	}
	//初始化数据
	adminOperation.prototype.initData = function() {
		var $this = this;
		$.ajax({
			type: "post",
			url: "adminMidFunc.php",
			dataType: "json",
			data: {
				type: 0
			},
			success: function(data){
				//data = eval("("+data+")");
				$('.totalUser i').text(data.totalUser);
				$('.totalCode i').text(data.totalCode);
				$('.totalScan i').text(data.totalScan);
				$('.scanUser i').text(data.totalScanUser);
				$('.newUser i').text(data.newUsers);
				$('.newScan i').text(data.newScan);
				$('.userRate').text(data.userRate.toFixed(2)*100+'%');
				$('.scanRate').text(data.scanRate.toFixed(2)*100+'%');
				$('.userRateBar .bar').css('width', data.userRate.toFixed(2)*100+'%');
				$('.scanRateBar .bar').css('width', data.scanRate.toFixed(2)*100+'%');

				// 用户列表
				var list = '';
				var l = data.userList;
				for(var i = 0; i < l.length; i++){
					var name = l[i].ManageUserName || '-';
					var account = l[i].WeChatAccount || '-';
					list += '<tr class="odd gradeX"><td>'+name+'</td><td>'+account+'</td><td>'+formatMyTime(l[i].createTime)+'</td>';
					if(l[i].status == "1"){
						list+='<td><input type="button" class="btn btn-success coverAcnt" value="恢复"><input type="button" class="btn btn-warning resetAcnt" value="重置"></td></tr>';
					} else if(l[i].status == "0"){
						list+='<td><input type="button" class="btn btn-danger stopAcnt" value="停用"><input type="button" class="btn btn-warning resetAcnt" value="重置"></td></tr>';
					} else {
						list+='<td><input type="button" class="btn btn-danger stopAcnt" value="停用"><input type="button" class="btn btn-success coverAcnt" value="恢复"><input type="button" class="btn btn-warning resetAcnt" value="重置"></td></tr>';
					}
					
				}
				$('.userList').html(list);
				$('.stopAcnt').bind('click', function(){
					var _this = $(this);
					opAccount = _this.parent().parent().children('td:eq(0)').text();
					$this.myAlert("", "确定停用该账户？", $this.operateAccount, 1);
				});
				$('.coverAcnt').bind('click', function(){
					var _this = $(this);
					opAccount = _this.parent().parent().children('td:eq(0)').text();
					$this.myAlert("", "确定恢复该账户？", $this.operateAccount, 0);
				});
				$('.resetAcnt').bind('click', function(){
					var _this = $(this);
					opAccount = _this.parent().parent().children('td:eq(0)').text();
					$this.myAlert("", "确定重置该账户密码？", $this.operateAccount, 2);
				});
			}
		});
	}

	$(function(){
		var admin = new adminOperation();
		admin.initData();
	});

	//时间格式化
	function formatMyTime(str) {
		var userAgent = navigator.userAgent; //取得浏览器的userAgent字符串
		var isIE = userAgent.indexOf("compatible") > -1 && userAgent.indexOf("MSIE") > -1 && !isOpera; //判断是否IE浏览器
		var isEdge = userAgent.indexOf("Edge") > -1; //判断是否IE的Edge浏览器
		console.log("isIE:" + isIE + isEdge);
		var d = new Date(str * 1000);
		if(isIE || isEdge) {
			commonTime = d.toLocaleString();
		} else
		commonTime = d.toLocaleString('chinese', {
			hour12: false
		});
		return commonTime;
	}

	</script>
	</html>